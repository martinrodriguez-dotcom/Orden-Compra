<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Orden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Encabezado con botón para volver -->
        <header class="flex items-center justify-between mb-6">
             <a href="index.html" class="flex items-center text-blue-600 hover:text-blue-800">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
                Volver al listado
            </a>
        </header>

        <!-- Contenedor de Detalles de la Orden -->
        <main id="order-details-container" class="bg-white rounded-lg shadow-lg p-6 md:p-8">
            <!-- Esta sección se llenará con JavaScript -->
            <div id="loading-state" class="text-center text-gray-500">
                <p>Cargando detalles de la orden...</p>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- LÓGICA DE LA PÁGINA DE DETALLES ---

            const detailsContainer = document.getElementById('order-details-container');

            // Funciones auxiliares (deben ser las mismas que en index.html)
            const getOrders = () => JSON.parse(localStorage.getItem('purchaseOrders')) || [];
            const statusColors = { 'Aprobado': 'bg-green-500', 'Pendiente': 'bg-yellow-500', 'Rechazado': 'bg-red-500' };
            const formatCurrency = (amount) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(amount);
            const calculateTotal = (items) => items.reduce((total, item) => total + (item.quantity * item.price), 0);
            
            // Función para obtener el ID de la orden desde la URL
            const getOrderIdFromUrl = () => {
                const params = new URLSearchParams(window.location.search);
                return params.get('id');
            };

            // Función para renderizar los detalles de la orden
            const renderOrderDetails = () => {
                const orderId = getOrderIdFromUrl();
                const orders = getOrders();
                const order = orders.find(o => o.id === orderId);

                if (!order) {
                    detailsContainer.innerHTML = `<p class="text-red-500 font-bold text-center">Error: No se encontró la orden con el ID "${orderId}".</p>`;
                    return;
                }

                const total = calculateTotal(order.items);
                
                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `
                        <tr class="border-b">
                            <td class="px-6 py-4 whitespace-nowrap">${item.description}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">${item.quantity}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right">${formatCurrency(item.price)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right font-medium">${formatCurrency(item.quantity * item.price)}</td>
                        </tr>
                    `;
                });

                detailsContainer.innerHTML = `
                    <!-- Cabecera de la orden -->
                    <div class="flex flex-col md:flex-row justify-between items-start mb-6 pb-6 border-b">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Orden de Compra: <span class="text-blue-600">${order.id}</span></h1>
                            <p class="text-gray-500 mt-1">Fecha de Emisión: ${new Date(order.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>
                        <div class="mt-4 md:mt-0 text-left md:text-right">
                             <p class="text-sm text-gray-500">Estado</p>
                             <span class="text-lg font-bold px-3 py-1 rounded-full text-white ${statusColors[order.status]}">${order.status}</span>
                        </div>
                    </div>

                    <!-- Información del proveedor -->
                    <div class="mb-8">
                        <h2 class="text-xl font-semibold mb-2">Proveedor</h2>
                        <p class="text-gray-700 text-lg">${order.provider}</p>
                    </div>

                    <!-- Tabla de Items -->
                    <div>
                        <h2 class="text-xl font-semibold mb-4">Items Incluidos</h2>
                        <div class="overflow-x-auto border rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Unitario</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${itemsHtml}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Total -->
                    <div class="flex justify-end mt-8 pt-6 border-t">
                        <div class="text-right">
                            <p class="text-gray-500">Total de la Orden</p>
                            <p class="font-bold text-4xl text-gray-900">${formatCurrency(total)}</p>
                        </div>
                    </div>
                `;
            };

            // --- INICIALIZACIÓN ---
            renderOrderDetails();
        });
    </script>

</body>
</html>
